---
title: "Method comparision"
author: "Alexander Schwaiger"
date: "2023-01-20"
output: pdf_document
---
```{r eval=FALSE, message=FALSE, warning=FALSE}
source("General_Dependency.R")
source("Coda_Function.R") 
source("Ingarch_Function.R")
source("ZIM_Function.R")
source("General_Function.R")
source("General_PlotFunctions.R")
```


Plot parameters 
```{r eval = FALSE}
text_size <- 50
save_plots <- F
```


Preparation
```{r eval = FALSE}

#Choosing only fridges with all 4 categories
help1 <- weekly_category_data%>%
  group_by(fridge_id)%>%
  dplyr::select(main_category_id)%>%
  unique()%>%
  count(fridge_id)
  
ids_all <- help1$fridge_id[help1$n ==4]

ids <- ids_all

if(all(ids == ids_all)){
  ids_save <- "_all_"
}else {
  ids_save <- paste(ids,collapse = "-")
}

frame <- 0.5
window_method <- "extending"
save_results <- F
HistoryLength <- 0.5

#Ingarch specifications
MainCat <- 2

#Coda specifications

```


Performing the Analysis
```{r eval=FALSE, include=FALSE}
coda_result <-
  Coda.Analysis(
    Data_Raw  = weekly_category_data,
    Id = ids_all,
    Frame = frame,
    OneVsAll = T,
    PivotGroup =  c("1", "2", "3", "4"),
    TSpace = T,
    Log = T,
    ZeroHandling = "all",
    WindowMethod = window_method,
    HistoryLength = HistoryLength
  )

if(save_results){
  save(coda_result,file=here("Code/results",paste("coda_result_ids",paste(ids_save,collapse="-"),"history05",".RData",sep="")))
}


ingarch_result <-
  Ingarch.Analysis(
    Data_Raw= weekly_category_data,
    Id = ids_all,
    Frame = frame,
    Distribution = "poisson",
    Category_Main = c("1", "2", "3", "4"),
    WindowMethod = window_method,
    ZeroHandling = "none",
    External = F,
    Multicore = T,
    NCores = 10,
    PastOb = 1,
    PastMean = 1,
    HistoryLength = HistoryLength,
    TakeSubCategory = F
  )
  
  if(save_results){
  save(ingarch_result,file=here("Code/results",paste("ingarch_result_ids",paste(ids_save,collapse="-"),"frame07",".RData",sep="")))

  }

zim_result <- Zim.Analysis(
    Data_Raw = weekly_category_data,
    Id = ids_all,
    Frame = frame,
    Distribution = "poisson",
    Category_Main = c("1","2","3","4"),
    WindowMethod = window_method,
    Multicore = F,
    HistoryLength = 1,
    TakeSubCategory = F
  )

  if(save_results){
  save(zim_result,file=here("Code/results",paste("zim_result_ids",paste(ids_save,collapse="-"),".RData",sep="")))

  }
```

Loading previous result
```{r}
ids <- unique(coda_result$result$id)
PredictionStep <- 1
frame <- unique(coda_result$result$frame)
window_method <- unique(coda_result$result$windowMethod)
save_results <- F
HistoryLength <- unique(coda_result$result$history)

#Ingarch specifications
distr<-unique(ingarch_result$result$distribution)
zero_handling_ingarch <- unique(ingarch_result$result$zeroHandling)
external <- unique(ingarch_result$result$external)
if(external){
  external_plot <-"with external factors"
}else external_plot <- ""
past_means <- unique(ingarch_result$result$pastMean)
past_obs <- unique(ingarch_result$result$pastOb)
ingarch_settings <- expand_grid(past_means,past_obs)
MainCat <- unique(ingarch_result$result$main_category)


#Coda specifications
#zero_handling_coda<-unique(coda_result$result$zero_handling)
tspace<-T
take_log<-T
one_vs_all<-T

if(!identical(ids,unique(ingarch_result$result$id)) || 
   frame != unique(ingarch_result$result$frame) ||
   window_method != unique(ingarch_result$result$windowMethod) ||
   HistoryLength != unique(ingarch_result$result$history)) {
  stop("Ingarch and Coda base specifications differ")
}
```


```{r}
Coda1 <- Object.Load("F:/Uni/Masterarbeit/Master-Thesis_git/Simulation/Code/results/coda_result_ids_all_history05.RData")
Coda0 <- Object.Load("F:/Uni/Masterarbeit/Master-Thesis_git/Simulation/Code/results/coda_result_ids_all_.RData")
Coda07 <- Object.Load("F:/Uni/Masterarbeit/Master-Thesis_git/Simulation/Code/results/coda_result_ids_all_frame07.RData")
Coda1$result$oneVsAll<- TRUE
Coda0$result$oneVsAll <- TRUE

Ingarch03 <- Object.Load("F:/Uni/Masterarbeit/Master-Thesis_git/Simulation/Code/results/ingarch_result_ids_all_history05.RData")
Ingarch05 <- Object.Load("F:/Uni/Masterarbeit/Master-Thesis_git/Simulation/Code/results/ingarch_result_ids_all_.RData")
Ingarch07 <- Object.Load("F:/Uni/Masterarbeit/Master-Thesis_git/Simulation/Code/results/ingarch_result_ids_all_frame07.RData")

Coda_Combined <- rbind(Coda0$result,Coda1$result)
Ingarch_Combined <- rbind(Ingarch03$result,Ingarch05$result)

Plot.ErrorMeasureSingle(ResultCombined=Coda_Combined,Variation=c("One-vs-All"="oneVsAll"),Values=c(TRUE,FALSE),Split=F,Category = c(1,2))

Plot.ErrorMeasureCombined(CodaCombined = Coda_Combined,IngarchCombined = Ingarch_Combined,Values=c("0.5","1"),Split=F,Variation = "history",LabelNames = c("0.5"="h=0.5","1"="h=1"))

```
