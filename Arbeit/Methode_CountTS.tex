\section{INGARCH}
\label{sec:Ingarch}

In this section we introduce the INGARCH(p,q), in short just INGARCH, model. First we provide a motivation on why we chose this model and review some other possible models for discrete time series count data. The review is mainly based on \cite{Liboschik:2016} and \cite{Heinen:2003}. A more detailed review can be found in \cite{Zucchini:1997}. Subsequently we define the INGARCH(p,q) model itself and list some of its properties. 

\subsection{Motivation}
\label{sec:Ingarch Motivation}

This section is based on \cite{Liboschik:2016} and \cite{Heinen:2003}. \newline
Since our data can be seen as a discrete time series with count data, we want a model which is able to take these properties into account. In addition, autocorrelation and over dispersion are two common features in count data. 
 
One common way to deal with count data are Markov chains. The dependent variable can take on all possible values in the so called state space and the probability of changing states is then modelled as a transition probability. A limitation is the fact that these models become cumbersome if the state space gets too big and lose tractability. As an extension to the basic Markov chains models, Hidden Markov chains are proposed by \cite{Zucchini:1997}. However, since there is no generally accepted way to determine the order of this model, it can cause problems if the data structure does not provide intuitive ways to do it. Another issue is that the number of parameters which need to be estimated gets big quickly, especially if the order of the model is big. 

Other common models for time series data are the ARMA models. There exists a discrete version of them in the form of the Discrete Autoregressive Moving Average (DARMA) models. They can be defined as a mixture of discrete probability distributions and a suitable chosen marginal probability function \cite{Biswas:2009}. While there have been various applications, for example in \cite{Chang:1987}, there seem to be difficulties in their estimation \cite{Heinen:2003}. 

State space models with conjugated priors are proposed by \cite{Harvey:1989}. The observations are assumed to be drawn from a Poisson distribution whose mean itself follows a Gamma distribution. The parameters of the Gamma distribution are chosen in such a way that its mean is constant but its variance is increasing. While there are ways proposed by \cite{Qaqish:1988} to handle overdispersion, these models have the weakness of needing further assumptions to handle zeros while also having more complicated model specifications \cite{Heinen:2003}.

While there are many more possible models, we decided to focus on the class of Generalised Linear Models (GLM). In the case of discrete time series with count data, the observations are modelled conditionally on the past and follow a discrete distribution. The conditional mean is then connected with a link function to the past observations and conditional means. Furthermore, a covariate vector can be introduced to account for external influence. While being easy to use and estimate they still provide a good amount of flexibility. In addition, a wide array of tools is available for various tests and forecasts. From the class of the GLMs we compare the INGARCH(p,q) and a log-linear model, which will be discussed in section \ref{sec: Other methods}. We then chose the INGARCH(p,q) model based on its superior performance and stability.

We also introduce an extension of the INGARCH model to multivariate data. However, since to our knowledge there is currently no R-package available to fit these models, we stay with the univariate version. 


\subsection{INGARCH Model}
\label{sec:Ingarch Model}
We construct the INGARCH(p,q) model as in \cite{Liboschik:2016}. 
Take again our time series $\left\{\bm{Y}_t:t=1,\ldots,T; \bm{Y}_t \in \mathbb{N}_0^K \right\}_f$ for fridge $f$ and denote the univariate time series for category $k$ with $\left\{Y_{kt}:t=1,\ldots,T; Y_{kt} \in \mathbb{N}_0\right\}_f$  for $k=1,\ldots,K$. This means $\bm{Y}_t = (Y_{1t},\ldots,Y_{Kt})^T$. Denote a r-dimensional time varying covariate vector with $\textbf{X}_{kt}=(X_{t1}^k,\ldots,X_{tr}^k)^T$. Let the conditional mean be $\lambda_{kt} = \mathbb{E}\left[Y_{kt} | \SigA_{k,t-1} \right]$ where $\SigA_{k,t-1}$ is the $\sigma$-field generated by $Y_{kt}$ and $\lambda_l$ for $l<t$ $, \SigA _{k,t-1}= \sigma(Y_{k1},\ldots,Y_{kl},\lambda_1, \ldots, \lambda_l)$. Therefore, the conditional mean of the time series is dependent on its combined history of the past conditional means and its past values. With this, we can define the integer valued generalized autoregressive conditional heteroskedasticity model of order (p,q) (INGARCH(p,q) model) for category $k=1,\ldots,K$ as,

\begin{gather}
\label{eq:Ingarch model}
Y_{kt} | \SigA_{k,t-1} \sim P(\lambda_{kt}); \forall t \in \mathbb{N}, \\
\mathbb{E}\left[Y_{kt} | \SigA_{k,t-1} \right] = \lambda_{kt} = \beta_0 + \sum_{i=1}^p\beta_i Y_{k,t-i} + \sum_{j=1}^q\alpha_j \lambda_{k,t-j},
\end{gather}

where $p,q \in \mathbb{N}$ and $P(\lambda_{kt})$ is a Poisson distribution with mean $\lambda_{kt}$. The integer $p$ defines the number of past values to regress on, whereas $q$ does the same for the past conditional means. In order to account for external effects as well, we add the covariate vector $\textbf{X}_{kt}$

\begin{gather}
\label{eq:Ingarch model with external effect}
Y_{kt} | \SigA_{k,t-1} \sim P(\lambda_{kt}); \forall t \in \mathbb{N}, \\
\mathbb{E}\left[Y_{kt} | \SigA_{k,t-1} \right] = \lambda_{kt} = \beta_0 + \sum_{i=1}^p\beta_i Y_{k,t-i} + \sum_{j=1}^q\alpha_j \lambda_{k,t-j} + \bm{\eta}^T\textbf{X}_{kt},
\end{gather}

where $\bm{\eta}$ is the parameter for the covariates such that $\bm{\eta}^T\textbf{X}_{kt} \geq 0$.
From the distributional assumption $Y_{kt} | \SigA_{k,t-1} \sim P(\lambda_{kt})$ it follows

\begin{equation}
p_{kt}(y;\bm{\theta})=\mathbb{P}(Y_{kt}=y | \SigA_{k,t-1}) = \frac{\lambda_{kt}^y \exp(-\lambda_{kt})}{y!}, \hspace{0.2cm} y \in \mathbb{N}_0.
\label{eq:Ingarch Distribution}
\end{equation}

Furthermore it can be shown that conditionally on the past history $\SigA_{k,t-1}$ the model is equidispersed, i.e. it holds $\lambda_{kt} = \mathbb{E}\left[Y_{kt} | \SigA_{k,t-1}\right] = \mathbb{V}\left[Y_{kt} | \SigA_{k,t-1}\right]$. However, unconditionally the model exhibits overdispersion. In that case it holds $\mathbb{E}\left[Y_{kt}\right] \leq \mathbb{V}\left[Y_{kt}\right] $ \cite{Heinen:2003}. 

\subsubsection{Parameter Estimation and Forecasting}
\label{sec: Estimation of the Ingarch Model}

We summarise the estimation of the INGARCH(p,q) Model as described in \cite{Liboschik:2016}. The model is estimated for each category $k=1,\ldots,K$ separately. 

The parameter space for the INGARCH(p,q) model with external effects \ref{eq:Ingarch model with external effect} is given by 

\begin{equation}
\Theta = \left\{ \bm{\theta} \in \mathbb{R}^{p+q+r+1}: \beta_0 > 0, \beta_1,\ldots,\beta_p,\alpha_1,\ldots,\alpha_q,\eta_1,\ldots,\eta_r \geq 0, \sum_{i=1}^p\beta_i + \sum_{j=1}^q\alpha_j < 1 \right\}.
\label{eq:Ingarch parameter space}
\end{equation}

To ensure positivity of the conditional mean $\lambda_{kt}$, the intercept $\beta_0$ must be positive while all other parameters must be non negative. The upper bound of the sum ensures that the model has a stationary and ergodic solution with moments of any order \cite{Ferland:2006,Fokianos:2009,Doukhan:2012}. A quasi maximum likelihood approach is used to estimate the parameters $\bm{\theta}$. 
For observations $\textbf{y}_k = \left(y_{k1},\ldots,y_{kT}\right)^T$ for category $k=1,\ldots,K$, the conditional quasi log-likelihood function, up to a constant, is given by,

\begin{equation}
\loglik_k(\bm{\theta}) = \sum_{t=1}^T\log p_{kt}(y_{kt};\bm{\theta}) = \sum_{t=1}^T \left(y_{kt}\log(\lambda_{kt}(\bm{\theta})) - \lambda_{kt}(\bm{\theta})\right).
\label{eq: Quasi log likelihood}
\end{equation}

where $p_{kt}(y_{kt};\bm{\theta})$ is the probability density function defined in \ref{eq:Ingarch Distribution}. The conditional mean is seen as a function $\lambda_{kt}: \Theta \rightarrow \mathbb{R}^{+}$. The conditional score function is given by,

\begin{equation}
S_{kT}(\bm{\theta}) = \frac{\partial \loglik_k(\bm{\theta})}{\partial \bm{\theta}} = \sum_{t=1}^T\left(\frac{y_{kt}}{\lambda_{kt}(\bm{\theta})}-1\right)\frac{\partial\lambda_{kt}(\bm{\theta})}{\partial \bm{\theta}}.
\label{eq:conditional score}
\end{equation}

The vector $\frac{\partial\lambda_{kt}(\bm{\theta})}{\partial \bm{\theta}}$ can be computed recursively. 
The conditional information matrix is given by, 

\begin{align}
G_{kT}(\theta) &= \sum_{t=1}^T Cov\left(\frac{\partial \loglik_k(\bm{\theta}; Y_{kt})}{\partial \bm{\theta}} \middle| \SigA_{k,t-1}\right) \\
&=  \sum_{t=1}^T \left(\frac{1}{\lambda_{kt}\left(\bm{\theta}\right)}\right) \left(\frac{\partial \lambda_{kt}(\bm{\theta})}{\partial \bm{\theta}}\right)\left(\frac{\partial \lambda_{kt}(\bm{\theta})}{\partial \bm{\theta}}\right)^T.
\label{eq:conditional information matrix}
\end{align}

Finally, assuming that the quasi maximum likelihood estimator (QMLE) $\hat{\bm{\theta}}_T$ of $\bm{\theta}$ exists, it is the solution to 

\begin{equation}
\hat{\bm{\theta}}:= \hat{\bm{\theta}}_T = \text{arg max}_{\bm{\theta} \in \Theta} (\loglik_k(\bm{\theta})). 
\label{eq:ingarch qmle}
\end{equation}

The optimal one-step ahead forecast with regards to the mean squared error is the conditional expectation $\lambda_{k,t+1}=\mathbb{E}\left[Y_{k,t+1} | \SigA_{kt} \right]$. The h-step ahead prediction for $h>1$ is calculated iteratively with the one step ahead predictions of $Y_{k,t+1},Y_{k,t+2},\ldots$ \cite{Liboschik:2016}. 


\subsection{Multivariate INGARCH model}
\label{sec: Multivariate Ingarch}

Since we have multivariate data, we also investigate multivariate versions of the INGARCH model. There have been various approaches in literature to expend the univariate INGARCH model to more dimensions. Bivariate models have been proposed by \cite{Liu:2012} and  extended for example by \cite{Cui:2018}. The authors in \cite{Fokianos:2020,Fokianos:2021} introduce and review the multivariate INGARCH model on the basis of a data generating process. Let $\bm{\lambda}_t=\mathbbm{E}[\bm{Y}_t|\SigA_t]$ where $\bm{\lambda}_t = (\lambda_{1t},\ldots,\lambda_{Kt})^T$ and $\SigA_t$ is the $\sigma$-field generated by $\left\{\bm{Y}_0,\ldots,\bm{Y}_t,\bm{\lambda}_0\right\}$. Then for each $k=1,\ldots,K$ we assume

\begin{gather}
Y_{kt} | \SigA_{t-1} \sim P(\lambda_{kt}), \\
\bm{\lambda}_t = \bm{d} + \bm{A}\bm{\lambda}_{t-1} + \bm{B}\bm{Y}_{t-1}.
\label{eq:Mingarch 1}
\end{gather}

Based on this, a joint distribution is constructed using a copula structure. After an additional transformation, the multivariate INGARCH model is

\begin{gather}
\bm{Y}_t = \bm{N}_t(\bm{\lambda}_t), \\
\bm{\lambda}_t = \bm{d} + \bm{A}\bm{\lambda}_{t-1} + \bm{B}\bm{Y}_{t-1},
\label{eq:Mingarch 1 new}
\end{gather}

where $\left\{\bm{N}_t\right\}$ is a sequence of p-variate independent copula-Poisson processes that counts the number of events in $[0,\lambda_{1t}]\times,\ldots,\times[0,\lambda_{Kt}]$ \cite{Fokianos:2020}. 

Another approach is taken by \cite{Lee:2023}. Instead of constructing a joint distribution for the multivariate vector $\bm{Y}_t$, they fit a one-parameter exponential family conditional distribution to each component $Y_{kt}$

\begin{equation}
p_{k}(y|\nu) = \exp(\nu y - A_k(\nu))h_k(y), \hspace{0.5cm} y \in \mathbbm{N}_0,
\label{eq:Exponential Family}
\end{equation}

where $A_k$ and $h_k$ are known functions and $\nu$ is the natural parameter. Both $A_k$ and $B_k(\nu) = \frac{d A_k(\nu)}{d \nu}$ are strictly increasing \cite{Lee:2023}. The multivariate INGARCH model is then given for each $k=1,\ldots,K$ by

\begin{gather}
Y_{kt} | \SigA_{t-1} \sim p_k(y|\nu_{kt}), \\
\bm{\lambda}_t := \mathbbm{E}[\bm{Y}_t | \SigA_{t-1}] = f_{\theta}(\bm{\lambda}_{t-1},\bm{Y}_{t-1}),
\label{eq:Mingarch 2}
\end{gather}

where $\SigA_{t-1}$ is the $\sigma$-field generated by $\left\{\bm{Y}_{t-1},\bm{Y}_{t-2},\ldots,B_k(\nu_{kt})\right\}$ with $B_k(\nu_{kt})=\lambda_{kt}$, and $f_{\theta}$ is a non-negative function on $[0,\infty)^K \times \mathbb{N}_0^K$ \cite{Lee:2023}. So for each component $Y_{kt}$ a univariate INGARCH model is fit but the components are connected by the conditional mean process. 

\input{Other_CountTS}